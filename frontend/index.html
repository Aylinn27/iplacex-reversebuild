<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login - ReverseBuild</title>
    <link rel="stylesheet" href="css/styles.css">
</head>
<body style="display: flex; justify-content: center; align-items: center; height: 100vh;">

    <div class="container">
        <div style="text-align: center; margin-bottom: 20px;">
            <h1 style="color: #bb86fc;">ReverseBuild</h1>
            <p>Soluciones S.A.</p>
        </div>

        <div class="card">
            <h3> Iniciar Sesi贸n</h3>
            <form id="loginForm">
                <input type="email" id="email" placeholder="Correo electr贸nico" required>
                <input type="password" id="password" placeholder="Contrase帽a" required>
                <button type="submit">Ingresar</button>
            </form>
            <p id="errorMsg" style="color: #cf6679; text-align: center; display: none;"></p>
        </div>
        
        <p style="text-align: center; font-size: 0.8em; margin-top: 20px;">
            <a href="#" onclick="crearUsuarioPrueba()" style="color: #03dac6;">Registrar Admin (Demo)</a>
        </p>
    </div>

    <script>
        const API_URL = 'http://localhost:3000/api/auth';

        document.getElementById('loginForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;

            try {
                const res = await fetch(`${API_URL}/login`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ email, password })
                });

                const data = await res.json();

                if (res.ok) {
                    localStorage.setItem('token', data.token);
                    window.location.href = 'dashboard.html';
                } else {
                    mostrarError(data.msg || 'Error al ingresar');
                }
            } catch (error) {
                mostrarError('Error de conexi贸n con el servidor');
            }
        });

        function mostrarError(msg) {
            const errorP = document.getElementById('errorMsg');
            errorP.textContent = msg;
            errorP.style.display = 'block';
        }

        async function crearUsuarioPrueba() {
            const email = prompt("Email nuevo:");
            const password = prompt("Contrase帽a nueva:");
            if(email && password) {
                const res = await fetch(`${API_URL}/register`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ email, password })
                });
                if(res.ok) alert("Usuario creado. Ahora inicia sesi贸n.");
                else alert("Error al crear usuario.");
            }
        }
    </script>
</body>
</html>